<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <form class="row g-3 needs-validation" novalidate (ngSubmit)="onSubmit()">

        <div class="col-12 mb-3">
          <input
          type="file"
          class="form-control"
          accept="image/jpeg,image/png,image/jpg,image/gif"
          (change)="onFileSelected($event)"
          [disabled]="isUploading">

          @if(isUploading){
          <div class="text mt-2">
          <small>Uploading Image ...</small>
          </div>
          }

          @if(imagePreviewUrl){
            <div class="mt-3">
              <img
              [src]="imagePreviewUrl"
              alt="Preview"
              class="img-thumbnail"
              style="max-width: 200px; max-height: 200px;"
              >
            </div>
          }
          @if(isEditMode && product.imageUrl && !imagePreviewUrl){
            <div class="mt-3">
              <img [src]="product.imageUrl"
                   alt="Current Product image"
                   class="img-thumbnail"
                   style="max-width: 200px; max-height: 200px;">


            </div>
          }
        </div>
        <div class="col-12 mb-3">
          <input type="text" [(ngModel)]="product.name" [ngModelOptions]="{standalone: true}" required
                 class="form-control"
                 placeholder="Product Name" aria-label="Product Name">
          <div class="invalid-feedback">
            Product name is necessary!
          </div>
        </div>

        <div class="col-6 mb-3 input-group">
          <span class="input-group-text">
            <i class="bi bi-box"></i>
          </span>
          <input type="text" [(ngModel)]="product.amount" [ngModelOptions]="{standalone: true}" required
                 class="form-control"
                 placeholder="Amount" aria-label="Amount">
          <div class="invalid-feedback">
            Amount is necessary!
          </div>
        </div>

        <div class="col-6 mb-3 input-group">
          <span class="input-group-text">â‚º</span>
          <input type="text" [(ngModel)]="product.price" [ngModelOptions]="{standalone: true}" required
                 class="form-control"
                 placeholder="Price" aria-label="Price">
          <span class="input-group-text">.00</span>
          <div class="invalid-feedback">
            Price is necessary!
          </div>
        </div>

        <!-- Supplier Autocomplete Section -->
        <div class="col-12 mb-3 position-relative">
          <input
            [(ngModel)]="typedSupplier"
            (input)="onSupplierInputChange()"
            (focus)="onInputFocus()"
            (blur)="onInputBlur()"
            [ngModelOptions]="{standalone: true}"
            required
            class="form-control"
            placeholder="Type supplier name..."
            aria-label="Supplier"
            autocomplete="off">

          <!-- Dropdown List -->
          @if (showDropdown) {
            <ul class="list-group position-absolute w-100" style="z-index: 1000; max-height: 200px; overflow-y: auto;">
              @for (supplier of filteredSuppliers; track supplier.id) {
                <li
                  class="list-group-item list-group-item-action"
                  style="cursor: pointer;"
                  (click)="selectSupplier(supplier)">
                  {{ supplier.name }}
                </li>
              }
              @if (filteredSuppliers.length === 0) {
                <li class="list-group-item text-muted">
                  No suppliers found
                </li>
              }
            </ul>
          }

          <div class="invalid-feedback">
            Supplier selection is necessary!
          </div>
        </div>

        <div class="col-12 d-flex justify-content-end gap-2">
          <button type="button" class="btn" (click)="onCancelClick()">
            Cancel
          </button>
          <button class="btn" type="submit">
            {{isUploading? "Uploading..." :(isEditMode ? 'Update' : 'Create' )}}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
